<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<link rel="stylesheet" href="style.css">
	<title>Capture</title>
</head>
<body>
	<!-- 导航栏 开始 -->
	<nav class="navbar navbar-default navbar-fixed-top" style="z-index: 100;">
		<div class="container">
			<div class="navbar-header">
				<a href="javascript:void(0)" onclick="testClickCapture()" class="navbar-brand logo"><img src="img/logo.jpg" width="162px" height="50px" alt="altalt"></a>
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
					<!-- 三根线 -->
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
			</div>
			<div class="collapse navbar-collapse" id="navbar-collapse">
				<ul class="nav navbar-nav navbar-right">
					<li>
						<a href="index.html"><span class="glyphicon glyphicon-home"></span> Index</a>
					</li>
					<li class="active">
						<a href="capture.html"><span class="glyphicon glyphicon-camera"></span> Capture</a>
					</li>
					<li>
						<a href="file.html"><span class="glyphicon glyphicon-file"></span> File</a>
					</li>
					<li>
						<a href="setting.html"><span class="glyphicon glyphicon-cog"></span> Setting</a>
					</li>
					<li>
						<a href="debug.html"><span class="glyphicon glyphicon glyphicon-list-alt"></span> Debug</a>
					</li>
				</ul>
			</div>
		</div>
	</nav>
	<!-- 导航栏 结束 -->

	<!-- 路径 开始-->
	<nav class="navbar navbar-default navbar-fixed-top navbar_path" style="z-index: 99;">
		<!-- <div id="path_bg" class="container"> -->
		<div class="container">
			<div class="row">
				<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
					<div class="input-group">
					  <span  id="proRoot" class="input-group-addon" id="basic-addon3">/mnt/DCIM/</span>
					  <input id="proName" type="text" class="form-control" id="basic-url" aria-describedby="basic-addon3" placeholder="a-z, A-Z, 0-9, '_'">
					  <span class="input-group-btn">
					  	<button class="btn btn-default" type="button" onclick="onClickRefreshPro()">
					  		<span class="glyphicon glyphicon-refresh"></span>
					  	</button>
					  </span>
					</div>
				</div>
			</div>
			<div id="alertTips" class="alert alert-warning fade in hidden" style="margin-top: 10px;"></div>
		</div>
	</nav>
	<!-- 路径 结束 -->

	<!-- 模态框（Modal）弹出框 -->
	<div class="modal" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" aria-hidden="true" id="modalClose">&times;</button>
					<h4 class="modal-title" id="myModalLabel">Tips</h4>
				</div>
				<div class="modal-body" id="modalBody">
					<span> Are you sure to <span style="color: #f00;">DELETE</span>?</span>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" id="modalYES">Yes</button>
					<button type="button" class="btn btn-primary" id="modalNo">No</button>
				</div>
			</div>
			<!-- /.modal-content -->
		</div>
		<!-- /.modal -->
	</div>

	<!-- 照片列表 开始 -->
	<div id="album_bg" class="container">
		<!-- <div class="row"> -->
		<!-- <div class="row" id="my-gallery-container"></div> -->
	</div>
	<!-- 照片列表 结束 -->
	

	<footer id="footer_status" class="navbar-fixed-bottom">
		<span id="spanVideoTime" style="color: #fff; margin-top: 5px;font-size: 20px;">00:00</span>
	</footer>
	<!-- 底部 开始 -->
	<footer id="footer_capture" class="navbar-fixed-bottom">
		<div class="container">
			<div class="row">
				<div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
					<div class="dropup" id="hdr_bg">
						<button class="btn btn-info dropdown-toggle" type="button" id="dropdownParams" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span id="spanParams">HDR 0</span>&nbsp;&nbsp;<span class="caret"></span></button>
						<ul class="dropdown-menu" aria-labelledby="dropdownParams" id="dropdownParamsList">
							<li><a href="javascript:void(0)" onclick="onClickListParams(this)">HDR 0</a></li>
							<li><a href="javascript:void(0)" onclick="onClickListParams(this)">HDR 1</a></li>
							<li><a href="javascript:void(0)" onclick="onClickListParams(this)">HDR 2</a></li>
							<li><a href="javascript:void(0)" onclick="onClickListParams(this)">HDR 3</a></li>
						</ul>
					</div>
				</div>
				<div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
					<button class="btn btn-info btn-circle" id="captureBtn" onclick="onClickCaptureBtn()"><span class="glyphicon glyphicon-camera"></span></button>
				</div>
				<div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
					<div class="dropup" id="mode_bg">
						<button class="btn btn-info dropdown-toggle" type="button" id="dropdownMode" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span id="spanMode">All</span>&nbsp;&nbsp;<span class="caret"></span></button>
						<ul class="dropdown-menu dropdown-menu-left" aria-labelledby="dropdownMode">
							<li><a href="javascript:void(0)" onclick="onClickListMode(this)">All</a></li>
							<li><a href="javascript:void(0)" onclick="onClickListMode(this)">A</a></li>
							<li><a href="javascript:void(0)" onclick="onClickListMode(this)">B</a></li>
							<li><a href="javascript:void(0)" onclick="onClickListMode(this)">Single</a></li>
							<li><a href="javascript:void(0)" onclick="onClickListMode(this)">Record</a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</footer>
	<!-- 底部 结束 -->

	<!-- 先让网页显示出来，再加载js -->
	<script type="text/javascript" src="js/jquery.min.js"></script>
	<script type="text/javascript" src="js/bootstrap.min.js"></script>
	<script type="text/javascript" src="Protocol.js" charset="utf-8"></script>
	<script type="text/javascript" src="js/mp.mansory.min.js"></script>
	<script type="text/javascript">
		 
		 //默认隐藏录像时间
		 $("#spanVideoTime").hide();

		 $(window).load(function() {
		 	//footer_capture 居中
			$('#hdr_bg').css('margin-top', ($('#footer_capture').height() - $('#hdr_bg').height()) * 0.5);
			$('#mode_bg').css('margin-top', ($('#footer_capture').height() - $('#mode_bg').height()) * 0.5);
			$('#captureBtn').css('margin-top', ($('#footer_capture').height() - $('#captureBtn').height()) * 0.5 - 5);
			//5px 适配，button自带margin

			//album_bg
			$('#album_bg').css('margin-bottom', (parseInt($('#footer_status').css('margin-bottom').replace(/[^-\d\.]/g, '')) + $('#footer_status').height()) + 'px')

			//弹出框显示在中间
			$('#myModal').on('shown.bs.modal', function (e) {
	            // 关键代码，如没将modal设置为 block，则$modala_dialog.height() 为零
	            $(this).css('display', 'block');
	            var modalHeight = $(window).height() / 2 - $('#myModal .modal-dialog').height() / 2;
	            $(this).find('.modal-dialog').css({'margin-top': modalHeight});
       		});

       		initDev();

		});

		$(window).resize(function() {
			console.log("---------resize()------");
			//footer_capture 居中
			$('#hdr_bg').css('margin-top', ($('#footer_capture').height() - $('#hdr_bg').height()) * 0.5);
			$('#mode_bg').css('margin-top', ($('#footer_capture').height() - $('#mode_bg').height()) * 0.5);
			$('#captureBtn').css('margin-top', ($('#footer_capture').height() - $('#captureBtn').height()) * 0.5 - 5);//5px 适配，button自带margin

			//album_bg
			$('#album_bg').css('margin-bottom', (parseInt($('#footer_status').css('margin-bottom').replace(/[^-\d\.]/g, '')) + $('#footer_status').height()) + 'px')

			//弹出框显示在中间
			$('#myModal').on('shown.bs.modal', function (e) {
	            // 关键代码，如没将modal设置为 block，则$modala_dialog.height() 为零
	            $(this).css('display', 'block');
	            var modalHeight = $(window).height() / 2 - $('#myModal .modal-dialog').height() / 2;
	            $(this).find('.modal-dialog').css({'margin-top': modalHeight});
       		});
       		
		});

		$(document).keydown(function(event){
　　　　		//console.log("keyboard enter:" + event.keyCode);
			if (isPC() && event.keyCode == 13) 
			{
				console.log("keyboard click enter!");
				$("#proName").blur();
				onClickRefreshPro();
			}
　　　　  });

		function updateAlumStatus()
		{
			$("#my-gallery-container").mpmansory(
				{
					childrenClass: 'album_item', // default is a div
					columnClasses: 'padding', //add classes to items
					breakpoints:{
						lg: 3, 
						md: 3, 
						sm: 6,
						xs: 6
					},
					distributeBy: { order: false, height: false, attr: 'data-order', attrOrder: 'asc' }, //default distribute by order, options => order: true/false, height: true/false, attr => 'data-order', attrOrder=> 'asc'/'desc'
					onload: function (items) {
						//make somthing with items
					} 
				}
			);
		}

		jQuery(document).ready(function ( $ ) {
			//updateAlumStatus();
		});

		function initDev()
		{
			console.log("initDev()");

			//sync time
			sycTimeToDev();

			//set dir path
			var input_proName = document.getElementById("proName");
			input_proName.value = getCurrentTimeProName();

			//check status
			getDevStatus(function(result){
				refreshAll(result);
			});
		}

		function getCurrentTimeProName()
		{ 
			//创建对象  
			var date = new Date();  
			//获取年份  
			var y = date.getFullYear(); 
			//获取月份  返回0-11     
			var m =date.getMonth()+1; 
			// 获取日   
			var d = date.getDate();
			//获取星期几  返回0-6   (0=星期天)   
			var w = date.getDay();    
			//星期几
			var ww = ' 星期'+'日一二三四五六'.charAt(date.getDay()) ;
			//时
			var h = date.getHours();
			//分  
			var minute = date.getMinutes() 
			//秒 
			var s = date.getSeconds(); 
			//毫秒
			var sss = date.getMilliseconds() ;
			
			if(m<10){
			m = "0"+m;
			}
			if(d<10){
			d = "0"+d;
			}
			if(h<10){
			h = "0"+h;
			}
			if(minute<10){
			minute = "0"+minute;
			} 
			if(s<10){
			s = "0"+s;
			}
			
			if(sss<10){
			sss = "00"+sss;
			}else if(sss<100){
			sss = "0"+sss;
			}
			console.log("time is here ----- " + y+m+d+"_"+h+minute+s);
			return y+""+m+""+d+"_"+h+""+minute+""+s;  
		}

		function onClickCaptureBtn()
		{
			console.log("onClickCaptureBtn");

			modeValue = $("#spanMode").html();
			paramsValue  = parseInt($("#spanParams").html().replace(/[^-\d\.]/g, ''));
			pathName  = $("#proName").val();
			var pattern = /^[a-zA-Z0-9_]{1,}$/;
			if(!pathName.match(pattern))
			{
				showTips("folder name not permit !!!", "danger");
				return;
			}
			pathValue = $("#proRoot").html() + pathName;
			console.log("modeValue:" + modeValue + " paramsValue:" + paramsValue + " pathValue:" + pathValue);

			if ($("#proName").val() == "")
			{
				showTips("path empty !!!", "danger");
				return;
			}

			checkIsBusy(function(result, isRecording){
				if (result <= 0) 
				{
					console.log("相机不忙");
					
					if (modeValue != "Record") 
					{
						showTips("Capturing, please wait ....", "warning" , 60000);
					}

					//创建文件夹先
					createDir(pathValue, function(resultCreateDir){
						var resolution = 0;
						if (modeValue == "Record"){
							resolution = 2;
						}
						setResolution(resolution, function(resultResolution){
							//设置分辨率，才能开始拍照或者录像
							//不管返回，直接去拍照
							if (modeValue == "All") 
							{
								//capture_all
								captureAll(pathValue, paramsValue, function(resultCaptureAll){
									if (resultCaptureAll[OSC_JTAG_STATE] == OSC_JTAG_STATE_DONE)
									{
										showTips("Capture end !", "success");
										updateAlbum(resultCaptureAll);
									}
									else
									{
										showTips(resultCaptureAll[OSC_JTAG_ERR][OSC_JTAG_ERR_MESSAGE], "danger");
									}
								});
							}
							else if(modeValue == "A")
							{
								//capture_A
								captureA(pathValue, paramsValue, function(resultCaptureA){
									if (resultCaptureA[OSC_JTAG_STATE] == OSC_JTAG_STATE_DONE)
									{
										showTips("Capture end !", "success");
										updateAlbum(resultCaptureA);
									}
									else
									{
										showTips(resultCaptureA[OSC_JTAG_ERR][OSC_JTAG_ERR_MESSAGE], "danger");
									}
								});

							}
							else if(modeValue == "B")
							{
								//capture_B
								captureB(pathValue, paramsValue, function(resultCaptureB){
									if (resultCaptureB[OSC_JTAG_STATE] == OSC_JTAG_STATE_DONE)
									{
										showTips("Capture end !", "success");
										updateAlbum(resultCaptureB);
									}
									else
									{
										showTips(resultCaptureB[OSC_JTAG_ERR][OSC_JTAG_ERR_MESSAGE], "danger");
									}
								});
							}
							else if(modeValue == "Single")
							{
								//capture single
								captureSingle(pathValue, paramsValue, function(resultCaptureSingle){
									if (resultCaptureSingle[OSC_JTAG_STATE] == OSC_JTAG_STATE_DONE)
									{
										showTips("Capture end !", "success");
										updateAlbum(resultCaptureSingle);
									}
									else
									{
										showTips(resultCaptureSingle[OSC_JTAG_ERR][OSC_JTAG_ERR_MESSAGE], "danger");
									}
								});

							}
							else if(modeValue == "Record")
							{
								//start Record
								recordStart(pathValue, function(resultRecord){
									if (resultRecord[OSC_JTAG_STATE] == OSC_JTAG_STATE_DONE)
									{
										showTips("Recording now ! 「plz make sure take photo first」", "success", 10000);
										$("#spanVideoTime").show();
										refreshVideoTime();
									}
									else
									{
										showTips(resultRecord[OSC_JTAG_ERR][OSC_JTAG_ERR_MESSAGE], "danger");
									}
								});
							}
						});
					});
				}
				else
				{
					if(isRecording && modeValue == "Record")
					{
						//stopRecord
						recordStop(pathValue, function(resultStopRecord){
							if (resultStopRecord[OSC_JTAG_STATE] == OSC_JTAG_STATE_DONE)
							{
								showTips("Record end !", "success");
								updateAlbum(resultStopRecord);
							}
							else
							{
								showTips(resultStopRecord[OSC_JTAG_ERR][OSC_JTAG_ERR_MESSAGE], "danger");
							}
							$("#spanVideoTime").hide();
							$("#spanVideoTime").html("00:00");
						});
					}
					else
					{
						showTips("Device is busy !!!");
					}
				}
			});
		}

		function updateAlbum(jsonObj)
		{
			console.log("updateAlbum()");
			var newStr = "<div class=\"row\" id=\"my-gallery-container\">";
			path = jsonObj.results.path;
			count = jsonObj.results.count;
			aryFiles = jsonObj.results.files;
			mIndex = 0;

			outName = "";
			outUrl  = "";
			outUrlShow = "";
			outNum = 0;
			outPathDev = "";
			for(mIndex = 0; mIndex < count; mIndex++)
			{
				outNum = count - mIndex;
				tmpItem = aryFiles[mIndex];
				outName = tmpItem.name;
				outPathDev = path + "/" + outName;
				outUrl  = OSC_DEV_IP + outPathDev;
				outUrlShow = OSC_DEV_IP + "/show" + outPathDev; 
				newStr += generateAlbumItem(outNum, outName, outPathDev, outUrl, outUrlShow);
				//console.log("outName:" + outName + " outUrl:" + outUrl + " outUrlShow:" + outUrlShow + " outPathDev:" + outPathDev);
			}
			newStr += "</div>";
			//console.log("--------->" + newStr)
			$("#album_bg").html(newStr);
			updateAlumStatus();
		}

		function clearAlbum()
		{
			$("#album_bg").html("");
		}

		function generateAlbumItem(num, name, pathDev, url, urlShow)
		{
			console.log("generateAlbumItem()");
			imgSrc = url;
			imgTarget = "_blank";
			if(isVideo(name))
			{
				imgSrc = "img/videoitem.jpg";
				imgTarget = "_self";
			}
			var canClick = 1;
			if(isVideo(name) == 0 && isPhoto(name) == 0)
			{
				imgSrc = "img/fileitem.jpg";
				canClick = 0;
			}

			var itemStr = "";
			itemStr += "<div class=\"col-lg-3 col-md-3 col-sm-6 col-xs-6 album_item\">";
			itemStr +=     "<div class=\"thumbnail\">";
			if(canClick){
				itemStr +=    ("<a href=\"" + urlShow + "\" target=\"" + imgTarget + "\"><img src=\"" + imgSrc + "\" alt=\"\"	></a>");
			}else{
				itemStr +=    ("<a href=\"#\"><img src=\"" + imgSrc + "\" alt=\"\"	></a>");
			}
			itemStr +=         "<div class=\"caption\">";
			itemStr +=              ("<p>【" + num + "】" + name + "</p>");
			if(canClick){
				itemStr +=              ("<button class=\"btn btn-warning\" onclick=\"onClickDownload('" + url + "', '" + urlShow + "')\"><span class=\"glyphicon glyphicon-download-alt\"></span></button>&nbsp;&nbsp;");
			}
			itemStr +=              ("<button class=\"btn btn-danger\" onclick=\"onClickDel('" + name + "', '"  + pathDev + "')\"><span class=\"glyphicon glyphicon-trash\"></span></button>");
			itemStr +=         "</div>";
			itemStr +=      "</div>";
			itemStr += "</div>";
			return itemStr;
			 // data-toggle=\"modal\" data-target=\"#myModal\"
			// onclick=\"onClickDel('" + name + "', '"  + pathDev + "')\"
		}

		function checkIsBusy(resultCallback)
		{
			console.log("checkIsBusy");
			getDevStatus(function(result){
				ret = 0;
				isRecording = 0;
				for (tmp in result)
				{
					tmpRet = result[tmp];
					if (typeof(tmpRet) == 'number' && tmp !== "recTime" && tmp !== "tmPowerOn") 
					{
						console.log("state:" + tmp + " tmpRet:" + tmpRet);
						if (tmpRet > 0) 
						{
							ret = 1;
						}
						if (tmp == "isRecording" && tmpRet > 0) 
						{
							isRecording = 1;
						}
					}
				}
				resultCallback(ret, isRecording);
			});
		}

		var showTipsTimer;
		function showTips(msg, level="warning", timeout=3000)
		{
			console.log("showTips:" + msg);

			//clear timer
			clearTimeout(showTipsTimer);
			$("#alertTips").html(msg);
			var classAttr = "alert alert-" + level + " fade in"
			$("#alertTips").attr("class", classAttr);

			showTipsTimer = setTimeout(function(){
				console.log("showTips timeout ----");
				var classAttr = "alert alert-" + level + " fade out hidden";
				$("#alertTips").attr("class", classAttr);
				clearTimeout(showTipsTimer);
			}, timeout);

		}

		/*----- 刷新状态 start -----*/
		function refreshAll(jsonObj)
		{
			console.log("refreshAll()");
			var isRecording = jsonObj[OSC_JTAG_STATUS_ISRECORDING];
			if(isRecording == 1){
				$("#dropdownParams").hide();
				$("#spanVideoTime").show();
				$("#spanMode").html("Record");
				$("#captureBtn").html("<span class=\"glyphicon glyphicon-facetime-video\"></span>");
				refreshVideoTime();
			}
		}
		/*----- 刷新状态 end -----*/

		function onClickListParams(item)
		{
			itemValue = item.innerHTML
			console.log("onClickListParams:" + itemValue);
			$("#spanParams").html(itemValue);
		}

		function onClickListMode(item)
		{
			itemValue = item.innerHTML
			console.log("onClickListMode:" + itemValue);
			$("#spanMode").html(itemValue);
			if (itemValue == "Record") 
			{
				$("#captureBtn").html("<span class=\"glyphicon glyphicon-facetime-video\"></span>");
				$("#dropdownParams").hide();
			}
			else
			{	
				var innerValue = "";
				if (itemValue == "Single") 
				{
					innerValue += "<li><a href=\"javascript:void(0)\" onclick=\"onClickListParams(this)\">nLens 0</a></li>";
					innerValue += "<li><a href=\"javascript:void(0)\" onclick=\"onClickListParams(this)\">nLens 1</a></li>";
					innerValue += "<li><a href=\"javascript:void(0)\" onclick=\"onClickListParams(this)\">nLens 2</a></li>";
					innerValue += "<li><a href=\"javascript:void(0)\" onclick=\"onClickListParams(this)\">nLens 3</a></li>";
					innerValue += "<li><a href=\"javascript:void(0)\" onclick=\"onClickListParams(this)\">nLens 4</a></li>";
					innerValue += "<li><a href=\"javascript:void(0)\" onclick=\"onClickListParams(this)\">nLens 5</a></li>";
					innerValue += "<li><a href=\"javascript:void(0)\" onclick=\"onClickListParams(this)\">nLens 6</a></li>";
					innerValue += "<li><a href=\"javascript:void(0)\" onclick=\"onClickListParams(this)\">nLens 7</a></li>";
					$("#spanParams").html("nLens 0");
				}
				else
				{
					innerValue += "<li><a href=\"javascript:void(0)\" onclick=\"onClickListParams(this)\">HDR 0</a></li>";
					innerValue += "<li><a href=\"javascript:void(0)\" onclick=\"onClickListParams(this)\">HDR 1</a></li>";
					innerValue += "<li><a href=\"javascript:void(0)\" onclick=\"onClickListParams(this)\">HDR 2</a></li>";
					innerValue += "<li><a href=\"javascript:void(0)\" onclick=\"onClickListParams(this)\">HDR 3</a></li>";
					$("#spanParams").html("HDR 0");
				}
				$("#captureBtn").html("<span class=\"glyphicon glyphicon-camera\"></span>");
				$("#dropdownParamsList").html(innerValue);
				$("#dropdownParams").show();
			}
		}

		function getFileNameFromPath(path)
		{
			var pos = path.lastIndexOf("\/");
			strFileName = path.substring(pos + 1);//文件名带后缀
			return strFileName;
		}

		function isPC() {
		    var userAgentInfo = navigator.userAgent;
		    //alert(userAgentInfo);
		    var Agents = ["Android", "iPhone", "SymbianOS", "Windows Phone", "iPad", "iPod"];
		    var flag = true;
		    for (var v = 0; v < Agents.length; v++) {
		        if (userAgentInfo.indexOf(Agents[v]) > 0) {
		            flag = false;
		            break;
		        }
		    }
		    return flag;
		}

		function isAndroid() {
		    var userAgentInfo = navigator.userAgent;
		    //alert(userAgentInfo);
		    var Agents = ["Android"];
		    var flag = false;
		    for (var v = 0; v < Agents.length; v++) {
		        if (userAgentInfo.indexOf(Agents[v]) > 0) {
		            flag = true;
		            break;
		        }
		    }
		    return flag;
		}

		function isiPhoneOriPad() {
		    var userAgentInfo = navigator.userAgent;
		    //alert(userAgentInfo);
		    var Agents = ["iPhone", "iPad", "iPod"];
		    var flag = false;
		    for (var v = 0; v < Agents.length; v++) {
		        if (userAgentInfo.indexOf(Agents[v]) > 0) {
		            flag = true;
		            break;
		        }
		    }
		    return flag;
		}

		function onClickDownload(url, urlShow)
		{
			console.log("onClickDownload:" + url);
			//alert("isPC:" + isPC());
			if (isPC()){
				//电脑端直接弹出下载
				window.open(url);
			}else{

				if (isAndroid()) 
				{
					window.open(url);
				}
				else
				{
					//手机端，弹出提示，让他们点击图片，长按保存
					if(url.indexOf(".mp4") > 0 || url.indexOf(".MP4") > 0)
					{
						window.location.href=urlShow;
					}
					else
					{
						showTips("Tap the photo，then long press to「Save to album」！！！");
					}
				}
			}
		}

		function onClickRefreshPro()
		{
			pathValue = $("#proRoot").html() + $("#proName").val();
			console.log("onClickRefreshPro:" + pathValue);

			showTips("Refreshing ....");

			listFiles(pathValue, function(result){
				if(result.state == OSC_JTAG_STATE_DONE)
				{
					if (result.results.count <=0) 
					{
						showTips("no files !!!");
						clearAlbum();
					}
					else
					{
						showTips("Refresh end !", "success");
						updateAlbum(result);
					}
				}
				else
				{
					showTips("no files !!!");
					clearAlbum();
				}

			});
		}

		function onClickDel(name, pathDel)
		{
			console.log("onClickDel:" + name + " " + pathDel);
			//修改模态框的内容以及点击操作
			$('#modalBody').html("<span><span style=\"color: #f00;\">DELETE</span>&nbsp; " + name + "&nbsp;?</span>");

			//MARK - modal 模态框，每次点击之后，都要设置为off，且不能点击空白关闭和键盘关闭，因为会出现点击后调用多次的问题；
			$('#modalClose').click(function(){
				$('#modalClose').off();
				$('#modalNo').off();
				$('#modalYES').off();
				$('#myModal').modal("hide");
			});

			$('#modalNo').click(function(){
				$('#modalClose').off();
				$('#modalNo').off();
				$('#modalYES').off();
				$('#myModal').modal("hide");
			});

			$('#modalYES').click(function(){
				$('#modalClose').off();
				$('#modalNo').off();
				$('#modalYES').off();
				$('#myModal').modal("hide");
				showTips("Deleting ...");
				deleteFile(pathDel, function(result){
					showTips("Delete end ！", "success");
					setTimeout(function(){
						onClickRefreshPro();
					}, 1000);
				});
			});
			//不允许 点击空白处关闭，键盘关闭； 因为会积累重复提交的情况
			$('#myModal').modal({backdrop: 'static', keyboard: false});
			//代码调用 显示模态框的方法
			$('#myModal').modal("show");
		}

		var videoTimeInterval;
		function refreshVideoTime()
		{
			videoTimeInterval = setInterval(function() {
				getDevStatus(function(result){
					if(result.isRecording == 1)
					{
						console.log('---刷新秒数---- ' + formatSeconds(result.recTime));
						$("#spanVideoTime").html(formatSeconds(result.recTime));
					}
					else
					{
						clearInterval(videoTimeInterval);
					}
				});
			},1000);
		}

		function formatSeconds(value) {
            var sec = parseInt(value);// 秒
            var min = 0;// 分

            if(value >= 60) {
                min = parseInt(value/60);
                sec = parseInt(value%60);
            }

            var result = "";
            result += (min > 9 ? min : "0" + min);
            result += ":"
            result += sec > 9 ? sec : "0" + sec; 
            return result;
        }

		function isPhoto(name){
			if(name.indexOf(".jpg") > 0 || name.indexOf(".JPG") > 0 || name.indexOf(".jpeg") > 0 || name.indexOf(".JPEG") > 0 || name.indexOf(".png") > 0 || name.indexOf(".PNG") > 0)
			{
				return 1;
			}
			return 0;
		}

		function isVideo(name){
			if(name.indexOf(".mp4") > 0 || name.indexOf(".MP4") > 0){
				return 1;
			}
			return 0;
		}

		// --------------------------------------------------------------------------------------------------------
		// --------------------------------------------------------------------------------------------------------
		// --------------------------------------------------------------------------------------------------------
		// --------------------------------------------------------------------------------------------------------
		// --------------------------------------------------------------------------------------------------------
		// --------------------------------------------------------------------------------------------------------
		// --------------------------------------------------------------------------------------------------------
		// --------------------------------------------------------------------------------------------------------
		// --------------------------------------------------------------------------------------------------------
		// --------------------------------------------------------------------------------------------------------
		// --------------------------------------------------------------------------------------------------------
		// --------------------------------------------------------------------------------------------------------
		function sycTimeToDev()
		{
			console.log("sycTimeToDev()");
			var paramObj = new Object();
			paramObj.name = OSC_CMD_SETOPTIONS;
			paramObj.parameters = new Object();
			paramObj.parameters.options = new Object();
			paramObj.parameters.options[OSC_OPT_DATETIME] = Number(Math.round(new Date() / 1000));
			var jsonStr = JSON.stringify(paramObj);
			$.post(OSC_DEV_IP + OSC_EXECUTE, jsonStr, function(result){
				console.log("sync time result:" + result[OSC_JTAG_STATE]);
  			});
		}

		function getDevStatus(callback)
		{
			console.log("getDevStatus()");
			$.post(OSC_DEV_IP + OSC_STATUS, function(result){
				callback(result);
  			});
		}

		function createDir(path, callback)
		{
			console.log("createDir() path:" + path);
			var paramObj = new Object();
			paramObj.name = OSC_CMD_CREATEDIR;
			paramObj.parameters = new Object();
			paramObj.parameters[OSC_JTAG_PATH] = path;
			var jsonStr = JSON.stringify(paramObj);
			$.post(OSC_DEV_IP + OSC_EXECUTE, jsonStr, function(createDirResult){
				console.log("createDir result:" + createDirResult[OSC_JTAG_STATE]);
				callback(createDirResult);
  			}).error(function(createDirResultErr){
  				resultObj = JSON.parse(createDirResultErr.responseText);
  				console.log("createDir error result:" + resultObj[OSC_JTAG_STATE]);
  				//showTips(JSON.stringify(resultObj), "danger");
  				callback(resultObj);
  			});
		}

		function captureAll(path, hdr, callback)
		{
			console.log("captureAll() - path:" + path + " hdr:" + hdr);
			var paramObj = new Object();
			paramObj.name = OSC_CMD_CAPTUREALL;
			paramObj.parameters = new Object();
			paramObj.parameters[OSC_JTAG_PATH] = path;
			paramObj.parameters[OSC_JTAG_HDR] = hdr;
			var jsonStr = JSON.stringify(paramObj);
			$.post(OSC_DEV_IP + OSC_EXECUTE, jsonStr, function(resultCapAll){
				console.log("captureAll result:" + resultCapAll[OSC_JTAG_STATE]);
			 	listFiles(path, function(resultListFiles){
			 		callback(resultListFiles);
			 	});
  			}).error(function(resultCapAllErr){
  				resultObj = JSON.parse(resultCapAllErr.responseText);
  				console.log("captureAll error result:" + resultObj[OSC_JTAG_ERR][OSC_JTAG_ERR_MESSAGE]);
  				callback(resultObj);
  			});
		}

		function captureA(path, hdr, callback)
		{
			console.log("captureA() - path:" + path + " hdr:" + hdr);
			var paramObj = new Object();
			paramObj.name = OSC_CMD_CAPTUREA;
			paramObj.parameters = new Object();
			paramObj.parameters[OSC_JTAG_PATH] = path;
			paramObj.parameters[OSC_JTAG_HDR] = hdr;
			var jsonStr = JSON.stringify(paramObj);
			$.post(OSC_DEV_IP + OSC_EXECUTE, jsonStr, function(resultCapA){
				console.log("captureA result:" + resultCapA[OSC_JTAG_STATE]);
			 	listFiles(path, function(resultListFiles){
			 		callback(resultListFiles);
			 	});
  			}).error(function(resultCapAErr){
  				resultObj = JSON.parse(resultCapAErr.responseText);
  				console.log("captureA error result:" + resultObj[OSC_JTAG_ERR][OSC_JTAG_ERR_MESSAGE]);
  				callback(resultObj);
  			});
		}

		function captureB(path, hdr, callback)
		{
			console.log("captureB() - path:" + path + " hdr:" + hdr);
			var paramObj = new Object();
			paramObj.name = OSC_CMD_CAPTUREB;
			paramObj.parameters = new Object();
			paramObj.parameters[OSC_JTAG_PATH] = path;
			paramObj.parameters[OSC_JTAG_HDR] = hdr;
			var jsonStr = JSON.stringify(paramObj);
			$.post(OSC_DEV_IP + OSC_EXECUTE, jsonStr, function(resultCapB){
				console.log("captureB result:" + resultCapB[OSC_JTAG_STATE]);
			 	listFiles(path, function(resultListFiles){
			 		callback(resultListFiles);
			 	});
			}).error(function(resultCapBErr){
				resultObj = JSON.parse(resultCapBErr.responseText);
				console.log("captureB error result:" + resultObj[OSC_JTAG_ERR][OSC_JTAG_ERR_MESSAGE]);
				callback(resultObj);
			});
		}

		function captureSingle(path, nLens, callback)
		{
			console.log("captureSingle() - path:" + path + " nLens:" + nLens);
			var paramObj = new Object();
			paramObj.name = OSC_CMD_CAPTURESINGLE;
			paramObj.parameters = new Object();
			paramObj.parameters[OSC_JTAG_PATH] = path;
			paramObj.parameters[OSC_JTAG_NLENS] = nLens;
			var jsonStr = JSON.stringify(paramObj);
			$.post(OSC_DEV_IP + OSC_EXECUTE, jsonStr, function(resultCapSingle){
				console.log("captureSingle result:" + resultCapSingle[OSC_JTAG_STATE]);
			 	listFiles(path, function(resultListFiles){
			 		callback(resultListFiles);
			 	});
  			}).error(function(resultCapSingleErr){
  				resultObj = JSON.parse(resultCapSingleErr.responseText);
  				console.log("captureSingle error result:" + resultObj[OSC_JTAG_ERR][OSC_JTAG_ERR_MESSAGE]);
  				callback(resultObj);
  			});
		}

		function recordStart(path, callback)
		{
			console.log("recordStart() - path:" + path);
			var paramObj = new Object();
			paramObj.name = OSC_CMD_STARTRECORD;
			paramObj.parameters = new Object();
			paramObj.parameters[OSC_JTAG_PATH] = path;
			var jsonStr = JSON.stringify(paramObj);
			$.post(OSC_DEV_IP + OSC_EXECUTE, jsonStr, function(resultRecord){
				console.log("startRecord result:" + resultRecord[OSC_JTAG_STATE]);
				callback(resultRecord);
			}).error(function(resultRecordErr){
				resultObj = JSON.parse(resultRecordErr.responseText);
				console.log("startRecord error result:" + resultObj[OSC_JTAG_ERR][OSC_JTAG_ERR_MESSAGE]);
				callback(resultObj);
			});
		}

		function recordStop(path, callback)
		{
			console.log("recordStop()");
			var paramObj = new Object();
			paramObj.name = OSC_CMD_STOPRECORD;
			var jsonStr = JSON.stringify(paramObj);
			$.post(OSC_DEV_IP + OSC_EXECUTE, jsonStr, function(resultRecord){
				console.log("recordStop result:" + resultRecord[OSC_JTAG_STATE]);
			 	listFiles(path, function(resultListFiles){
			 		callback(resultListFiles);
			 	});
			}).error(function(resultRecordErr){
				resultObj = JSON.parse(resultRecordErr.responseText);
				console.log("startRecord error result:" + resultObj[OSC_JTAG_ERR][OSC_JTAG_ERR_MESSAGE]);
				callback(resultObj);
			});
		}

		function listFiles(path, callback, index=0, length=9999)
		{
			console.log("listFiles:" + path + " index:" + index + " length:" + length);
			var paramObj = new Object();
		 	paramObj.name = OSC_CMD_LISTFILES;
		 	paramObj.parameters = new Object();
		 	paramObj.parameters[OSC_JTAG_FL_PATH]   = path;
		 	paramObj.parameters[OSC_JTAG_FL_INDEX]  = index;
		 	paramObj.parameters[OSC_JTAG_FL_LENGTH] = length;
		 	var jsonStr = JSON.stringify(paramObj);
		 	$.post(OSC_DEV_IP + OSC_EXECUTE, jsonStr, function(resultListFiles){
				console.log("listFiles result:" + resultListFiles[OSC_JTAG_STATE]);
				console.log("listFiles return:" + JSON.stringify(resultListFiles));
				callback(resultListFiles);
			}).error(function(resultListFilesErr){
  				resultObj = JSON.parse(resultListFilesErr.responseText);
  				console.log("listFiles error result:" + resultObj.error.message);
  				//showTips(JSON.stringify(resultObj), "danger");
  				callback(resultObj);
  			});
		}

		function deleteFile(path, callback)
		{
			console.log("deleteFile:" + path);
			var paramObj = new Object();
		 	paramObj.name = OSC_CMD_DELETE;
		 	paramObj.parameters = new Object();
		 	paramObj.parameters[OSC_JTAG_FL_PATH]   = path;
		 	var jsonStr = JSON.stringify(paramObj);
		 	$.post(OSC_DEV_IP + OSC_EXECUTE, jsonStr, function(resultDel){
				console.log("deleteFile result:" + resultDel[OSC_JTAG_STATE]);
				console.log("deleteFile return:" + JSON.stringify(resultDel));
				callback(resultDel);
			}).error(function(resultDelErr){
  				resultObj = JSON.parse(resultDelErr.responseText);
  				console.log("deleteFile error result:" + resultDelErr[OSC_JTAG_STATE]);
  				//showTips(JSON.stringify(resultObj), "danger");
  				//callback(resultObj);
  			});
		}

		function setResolution(resolution, callback)
		{
			console.log("setResolution:" + resolution);
			var paramObj = new Object();
			paramObj.name = OSC_CMD_SETOPTIONS;
			paramObj.parameters = new Object();
			paramObj.parameters.options = new Object();
			paramObj.parameters.options[OSC_OPT_RESOLUTION] = resolution;
			var jsonStr = JSON.stringify(paramObj);
		 	$.post(OSC_DEV_IP + OSC_EXECUTE, jsonStr, function(resultResolution){
				console.log("setResolution result:" + resultResolution[OSC_JTAG_STATE]);
				console.log("setResolution return:" + JSON.stringify(resultResolution));
				callback(resultResolution);
			}).error(function(resultResolutionErr){
  				resultObj = JSON.parse(resultResolutionErr.responseText);
  				console.log("setResolution error result:" + resultResolutionErr[OSC_JTAG_STATE]);
  				showTips(JSON.stringify(resultObj), "danger");
  				//callback(resultObj);
  			});
		}

		// --------------------------------------------------------------------------------------------------------
		// --------------------------------------------------------------------------------------------------------
		// --------------------------------------------------------------------------------------------------------
		// --------------------------------------------------------------------------------------------------------
		// --------------------------------------------------------------------------------------------------------
		// --------------------------------------------------------------------------------------------------------		
		// --------------------------------------------------------------------------------------------------------
		// --------------------------------------------------------------------------------------------------------
		// --------------------------------------------------------------------------------------------------------
		// --------------------------------------------------------------------------------------------------------
		// --------------------------------------------------------------------------------------------------------
		// --------------------------------------------------------------------------------------------------------

		function testClickCapture(times = 5, sep = 15000)
		{
			console.log("testClickCapture() - " + times);
			var time = 0;
			var countStart = 0;
			for (var i = 0; i < times; i++) {
				time = (i) * sep;
				console.log("testClickCapture[" + i + "]:" + time);
				setTimeout(function(){
					countStart++;
					console.log("testClickCapture start [" + countStart + "]" );
					if(times == countStart)
					{
						showTips("Last one ~~~~~~~~~~~~~~~~~~!");
					}
					onClickCaptureBtn();
				}, time);
			}
		}

	</script>
</body>
</html>